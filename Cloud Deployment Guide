### **Cloud Deployment Guide**

This section provides step-by-step instructions for deploying the Agile Sprint Assistant to various cloud platforms.

---

## ☁️ **CLOUD DEPLOYMENT OPTIONS**

### **Option 1: Google Cloud Run** (Recommended)

**Why Cloud Run?**
- Serverless (no infrastructure management)
- Auto-scaling (0 to N instances)
- Pay only for usage
- Native integration with Google Gemini API
- Simple deployment process

#### **Prerequisites:**

1. **Google Cloud Account**
   - Sign up at [cloud.google.com](https://cloud.google.com)
   - Enable billing (free tier available: $300 credit)

2. **Install Google Cloud SDK**
```bash
   # Download from: https://cloud.google.com/sdk/docs/install
   
   # Verify installation
   gcloud --version
```

3. **Authenticate**
```bash
   gcloud auth login
   gcloud config set project YOUR_PROJECT_ID
```

#### **Step-by-Step Deployment:**

**Step 1: Prepare Application**

Create `Dockerfile` in project root:
```dockerfile
# Dockerfile
FROM python:3.11-slim

# Set working directory
WORKDIR /app

# Copy requirements
COPY requirements.txt .

# Install dependencies
RUN pip install --no-cache-dir -r requirements.txt

# Copy application code
COPY . .

# Expose port
EXPOSE 8080

# Set environment variables
ENV PORT=8080

# Run application
CMD cd ui && uvicorn app:app --host 0.0.0.0 --port 8080
```

Create `.dockerignore`:
```
# .dockerignore
venv/
__pycache__/
*.pyc
.env
.git/
*.db
.vscode/
logs/
```

**Step 2: Configure Environment Variables**

Create `env.yaml` (DO NOT commit this file):
```yaml
# env.yaml
GOOGLE_API_KEY: "your-actual-api-key-here"
DATABASE_URL: "sqlite:///database/agile_assistant.db"
SLACK_BOT_TOKEN: "xoxb-your-token-here"
SLACK_CHANNEL_ID: "C0XXXXXXXXX"
SLACK_ENABLED: "true"
```

Add to `.gitignore`:
```
env.yaml
```

**Step 3: Build and Deploy**
```bash
# Enable required APIs
gcloud services enable run.googleapis.com
gcloud services enable containerregistry.googleapis.com

# Set variables
export PROJECT_ID=your-project-id
export SERVICE_NAME=agile-sprint-assistant
export REGION=us-central1

# Build container
gcloud builds submit --tag gcr.io/${PROJECT_ID}/${SERVICE_NAME}

# Deploy to Cloud Run
gcloud run deploy ${SERVICE_NAME} \
  --image gcr.io/${PROJECT_ID}/${SERVICE_NAME} \
  --platform managed \
  --region ${REGION} \
  --allow-unauthenticated \
  --env-vars-file env.yaml \
  --memory 2Gi \
  --cpu 2 \
  --timeout 300s \
  --max-instances 10 \
  --min-instances 0
```

**Step 4: Access Application**

After deployment, you'll get a URL like:
```
https://agile-sprint-assistant-xxxxxxxxx-uc.a.run.app
```

**Step 5: Set Up Persistence (Optional)**

By default, SQLite database is ephemeral. For persistence:

**Option A: Use Cloud SQL (PostgreSQL)**
```bash
# Enable Cloud SQL API
gcloud services enable sqladmin.googleapis.com

# Create instance
gcloud sql instances create agile-db \
  --database-version=POSTGRES_14 \
  --tier=db-f1-micro \
  --region=${REGION}

# Create database
gcloud sql databases create agile_assistant \
  --instance=agile-db

# Update env.yaml with Cloud SQL connection string
DATABASE_URL: "postgresql://user:password@/agile_assistant?host=/cloudsql/PROJECT:REGION:agile-db"

# Redeploy with Cloud SQL
gcloud run deploy ${SERVICE_NAME} \
  --image gcr.io/${PROJECT_ID}/${SERVICE_NAME} \
  --add-cloudsql-instances PROJECT:REGION:agile-db \
  --env-vars-file env.yaml
```

**Option B: Use Cloud Storage for SQLite**
```bash
# Create bucket
gsutil mb gs://${PROJECT_ID}-agile-db

# Mount bucket in Cloud Run (requires update to app.py)
# Update DATABASE_PATH to use mounted bucket
```

**Step 6: Monitor and Logs**
```bash
# View logs
gcloud run services logs read ${SERVICE_NAME} --region=${REGION}

# View metrics
gcloud run services describe ${SERVICE_NAME} --region=${REGION}
```

**Step 7: Update Application**
```bash
# Make code changes, then:
gcloud builds submit --tag gcr.io/${PROJECT_ID}/${SERVICE_NAME}
gcloud run deploy ${SERVICE_NAME} \
  --image gcr.io/${PROJECT_ID}/${SERVICE_NAME} \
  --region ${REGION}
```

**Cost Estimate:**
- First 2 million requests/month: FREE
- Cloud Run: ~$0.10 per additional 1M requests
- Cloud SQL: ~$7/month (db-f1-micro)

---

### **Option 2: Heroku**

**Why Heroku?**
- Simple deployment with Git
- Managed database (PostgreSQL)
- Easy environment variable management

#### **Step-by-Step Deployment:**

**Step 1: Install Heroku CLI**
```bash
# Download from: https://devcenter.heroku.com/articles/heroku-cli

# Login
heroku login
```

**Step 2: Prepare Application**

Create `Procfile` in project root:
```
web: cd ui && uvicorn app:app --host 0.0.0.0 --port $PORT
```

Create `runtime.txt`:
```
python-3.11.5
```

Update `requirements.txt` to include PostgreSQL:
```
# Add to requirements.txt
psycopg2-binary==2.9.9
```

**Step 3: Create Heroku App**
```bash
# Create app
heroku create agile-sprint-assistant

# Add PostgreSQL
heroku addons:create heroku-postgresql:mini
```

**Step 4: Set Environment Variables**
```bash
heroku config:set GOOGLE_API_KEY=your-api-key
heroku config:set SLACK_BOT_TOKEN=xoxb-your-token
heroku config:set SLACK_CHANNEL_ID=C0XXXXXXXXX
heroku config:set SLACK_ENABLED=true
```

**Step 5: Deploy**
```bash
# Initialize git (if not already)
git init
git add .
git commit -m "Initial commit"

# Deploy to Heroku
git push heroku main

# Initialize database
heroku run python database/init_db.py

# Open app
heroku open
```

**Step 6: View Logs**
```bash
heroku logs --tail
```

**Cost Estimate:**
- Hobby tier: $7/month (includes PostgreSQL)
- Dyno hours: First 1000 hours/month free

---

### **Option 3: AWS (Elastic Beanstalk)**

**Why AWS EB?**
- Managed platform
- Auto-scaling
- Integrated with AWS ecosystem

#### **Step-by-Step Deployment:**

**Step 1: Install AWS EB CLI**
```bash
pip install awsebcli
```

**Step 2: Initialize EB**
```bash
eb init -p python-3.11 agile-sprint-assistant --region us-east-1
```

**Step 3: Create Environment**
```bash
eb create agile-prod-env
```

**Step 4: Set Environment Variables**
```bash
eb setenv GOOGLE_API_KEY=your-key \
  SLACK_BOT_TOKEN=xoxb-token \
  SLACK_CHANNEL_ID=C0XXXXX \
  SLACK_ENABLED=true
```

**Step 5: Deploy**
```bash
eb deploy
```

**Step 6: Open Application**
```bash
eb open
```

**Cost Estimate:**
- t2.micro (1 GB RAM): ~$8/month
- RDS PostgreSQL: ~$15/month

---

### **Option 4: Docker + Any Cloud VM**

**Why Docker?**
- Platform-agnostic
- Easy to move between providers
- Consistent environment

#### **Deployment to Digital Ocean, Linode, or any VPS:**

**Step 1: Create Droplet/VM**

- OS: Ubuntu 22.04
- RAM: 2GB minimum
- Storage: 25GB

**Step 2: SSH into Server**
```bash
ssh root@your-server-ip
```

**Step 3: Install Docker**
```bash
# Update packages
apt update
apt upgrade -y

# Install Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh

# Install Docker Compose
apt install docker-compose -y
```

**Step 4: Clone Repository**
```bash
git clone https://github.com/PriyankaUtekar/Agile-Sprint-Assistant.git
cd Agile-Sprint-Assistant
```

**Step 5: Create .env File**
```bash
nano .env
```

Add your environment variables (see Configuration section).

**Step 6: Create docker-compose.yml**
```yaml
version: '3.8'

services:
  web:
    build: .
    ports:
      - "80:8080"
    env_file:
      - .env
    volumes:
      - ./database:/app/database
    restart: always
```

**Step 7: Build and Run**
```bash
docker-compose up -d
```

**Step 8: Access Application**
```
http://your-server-ip
```

**Step 9: Set Up SSL (Optional but Recommended)**
```bash
# Install Certbot
apt install certbot python3-certbot-nginx -y

# Get certificate
certbot --nginx -d your-domain.com
```

**Cost Estimate:**
- Digital Ocean Droplet (2GB): $12/month
- Linode Nanode (2GB): $10/month

---

### **Deployment Comparison Table**

| Platform | Ease of Setup | Cost (Monthly) | Auto-Scaling | Database | Best For |
|----------|---------------|----------------|--------------|----------|----------|
| **Google Cloud Run** | ⭐⭐⭐⭐ | ~$5-20 | ✅ Yes | Cloud SQL | Production, auto-scale |
| **Heroku** | ⭐⭐⭐⭐⭐ | $7+ | ✅ Yes | PostgreSQL | Quick deploy, simple |
| **AWS EB** | ⭐⭐⭐ | $20+ | ✅ Yes | RDS | AWS ecosystem |
| **Docker VPS** | ⭐⭐ | $10+ | ❌ No | SQLite/Self-hosted | Full control, custom |

---

### **Post-Deployment Checklist**

- [ ] Application accessible via public URL
- [ ] Environment variables set correctly
- [ ] Database initialized with schema
- [ ] Gemini API working (test with planning agent)
- [ ] Slack notifications working (if enabled)
- [ ] SSL/HTTPS configured (for production)
- [ ] Monitoring/logging set up
- [ ] Backup strategy for database
- [ ] Domain name configured (optional)
- [ ] Authentication added (if needed for production)

---
