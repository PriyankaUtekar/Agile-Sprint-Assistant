{% extends "base.html" %}

{% block title %}Daily Standup - Agile Sprint Assistant{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="fas fa-users"></i> Daily Standup
            <small class="text-muted">Sprint {{ sprint.sprint_number if sprint else '?' }}</small>
        </h1>
    </div>
</div>

{% if sprint %}
<!-- Standup Control Panel -->
<div class="row mb-4">
    <div class="col-md-8">
        <div class="card border-primary">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-play-circle"></i> Standup Session</h5>
            </div>
            <div class="card-body">
                <div id="standup-welcome" class="alert alert-info" style="display: none;">
                    <pre id="welcome-message" class="mb-0" style="white-space: pre-wrap;"></pre>
                </div>
                
                <div class="text-center" id="start-standup-section">
                    <button id="start-standup-btn" class="btn btn-lg btn-success">
                        <i class="fas fa-play"></i> Start Daily Standup
                    </button>
                </div>
                
                <div id="standup-form-section" style="display: none;">
                    <div class="mb-3">
                        <label for="member-select" class="form-label">
                            <strong>Team Member:</strong>
                        </label>
                        <select class="form-select" id="member-select" required>
                            <option value="">Select team member...</option>
                            {% for member in team_members %}
                            <option value="{{ member.name }}">{{ member.name }} - {{ member.role }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="yesterday" class="form-label">
                            <i class="fas fa-check-circle text-success"></i> What did you complete yesterday?
                        </label>
                        <textarea class="form-control" id="yesterday" rows="3" required 
                                  placeholder="Describe what you accomplished yesterday..."></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label for="today" class="form-label">
                            <i class="fas fa-tasks text-primary"></i> What will you work on today?
                        </label>
                        <textarea class="form-control" id="today" rows="3" required 
                                  placeholder="Describe your plan for today..."></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label for="blockers" class="form-label">
                            <i class="fas fa-exclamation-triangle text-warning"></i> Any blockers or impediments?
                        </label>
                        <textarea class="form-control" id="blockers" rows="2" 
                                  placeholder="List any blockers or type 'None'...">None</textarea>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="confidence" class="form-label">
                                <i class="fas fa-smile"></i> Confidence Level
                            </label>
                            <select class="form-select" id="confidence">
                                <option value="high" selected>High - On track</option>
                                <option value="medium">Medium - Some concerns</option>
                                <option value="low">Low - Need help</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="hours-worked" class="form-label">
                                <i class="fas fa-clock"></i> Hours Worked Yesterday
                            </label>
                            <input type="number" class="form-control" id="hours-worked" 
                                   min="0" max="12" step="0.5" value="8">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="story-ids" class="form-label">
                            <i class="fas fa-bookmark"></i> User Stories (comma-separated, e.g., US-015, US-016)
                        </label>
                        <input type="text" class="form-control" id="story-ids" 
                               placeholder="US-015, US-016">
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="button" id="submit-update-btn" class="btn btn-primary btn-lg">
                            <i class="fas fa-paper-plane"></i> Submit Update
                        </button>
                    </div>
                </div>
                
                <div id="standup-response" class="mt-3" style="display: none;">
                    <div class="alert alert-success">
                        <pre id="response-message" class="mb-0" style="white-space: pre-wrap;"></pre>
                    </div>
                </div>
                
                <div id="generate-summary-section" class="mt-3" style="display: none;">
                    <button id="generate-summary-btn" class="btn btn-success btn-lg w-100">
                        <i class="fas fa-file-alt"></i> Generate Summary
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Summary Panel -->
    <div class="col-md-4">
        <div class="card border-info">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-info-circle"></i> Standup Info</h5>
            </div>
            <div class="card-body">
                <h6><i class="fas fa-bullseye"></i> Sprint Goal:</h6>
                <p class="small">{{ sprint.sprint_goal }}</p>
                
                <hr>
                
                <h6><i class="fas fa-users"></i> Team Members:</h6>
                <ul class="list-unstyled small">
                    {% for member in team_members %}
                    <li class="mb-2">
                        <i class="fas fa-user"></i> {{ member.name }}
                        <br><small class="text-muted">{{ member.role }}</small>
                    </li>
                    {% endfor %}
                </ul>
                
                <hr>
                
                <div id="progress-tracker">
                    <h6><i class="fas fa-tasks"></i> Progress:</h6>
                    <p id="progress-text" class="mb-0">Not started</p>
                </div>
            </div>
        </div>
        
        <!-- Tips Card -->
        <div class="card border-warning mt-3">
            <div class="card-header bg-warning text-dark">
                <h6 class="mb-0"><i class="fas fa-lightbulb"></i> Standup Tips</h6>
            </div>
            <div class="card-body small">
                <ul class="mb-0">
                    <li>Keep updates brief and focused</li>
                    <li>Be specific about blockers</li>
                    <li>Mention story IDs you're working on</li>
                    <li>Update your confidence honestly</li>
                    <li>Total time: 15 minutes max</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Summary Modal -->
<div class="modal fade" id="summaryModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">
                    <i class="fas fa-chart-line"></i> Standup Summary
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="summary-content">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
                
                <div id="metrics-content" class="mt-4" style="display: none;">
                    <h5>ðŸ“Š Key Metrics</h5>
                    <div class="row" id="metrics-cards"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="window.print()">
                    <i class="fas fa-print"></i> Print
                </button>
            </div>
        </div>
    </div>
</div>

{% else %}
<div class="alert alert-warning">
    <i class="fas fa-exclamation-triangle"></i> No active sprint found! Please create or activate a sprint first.
</div>
{% endif %}
{% endblock %}

{% block extra_scripts %}
<script src="/static/js/standup.js"></script>
{% endblock %}